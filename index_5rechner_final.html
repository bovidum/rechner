<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Feierabend- & Zeitkonto-Rechner (5 Rechner)</title>
  <style>
    :root{
      --orange:#ff9800;
      --orange-dark:#f57c00;
      --winter:#1e73be;
      --winter-dark:#155a92;
      --grey:#7a7a7a;
      --grey-dark:#5f5f5f;

      --bg1:#fff7e6;
      --bg2:#f3f3f3;
      --bg3:#e9e9e9;

      --card:#ffffff;
      --text:#333333;
      --muted:#6b6b6b;
      --border:#e0e0e0;
    }
    *{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI","Segoe UI Emoji","Apple Color Emoji","Noto Color Emoji",sans-serif}
    body{
      margin:0;
      padding:16px;
      background:radial-gradient(circle at top,var(--bg1) 0,var(--bg2) 45%,var(--bg3) 100%);
      color:var(--text);
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
      gap:16px;
      align-items:start;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 8px 18px rgba(0,0,0,.10);
      overflow:hidden;
    }
    .header{
      padding:14px 16px;
      font-weight:900;
      font-size:1.05rem;
      color:#fff;
      text-align:center;
      letter-spacing:.2px;
    }
    .header.orange{background:var(--orange-dark)}
    .header.winter{background:var(--winter-dark)}
    .header.grey{background:var(--grey-dark)}

    .content{padding:16px 16px 14px}
    h2{
      margin:0 0 10px;
      font-size:1rem;
      text-align:center;
      color:inherit;
      opacity:.95;
      font-weight:800;
    }
    .hint{
      font-size:.84rem;
      color:#6e6e6e;
      line-height:1.35;
      margin:4px 0 12px;
    }
    .row{display:flex;flex-direction:column;margin-bottom:10px}
    label{font-size:.92rem;font-weight:800;margin-bottom:4px}
    small{font-size:.78rem;color:#6b6b6b}
    input[type="time"], input[type="number"]{
      padding:8px 10px;
      font-size:1rem;
      border-radius:12px;
      border:1px solid #bdbdbd;
      width:200px;
      max-width:100%;
      background:#fff;
      color:#222;
    }
    input[type="number"]{width:220px}
    select{
      padding:8px 10px;
      font-size:1rem;
      border-radius:12px;
      border:1px solid #bdbdbd;
      max-width:100%;
      background:#fff;
      color:#222;
    }
    .btn-row{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
    button{
      border-radius:999px;
      border:none;
      padding:9px 14px;
      font-size:.92rem;
      cursor:pointer;
      font-weight:800;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn-main{background:var(--orange);color:#fff;box-shadow:0 3px 6px rgba(0,0,0,.18)}
    .btn-main.orange{background:var(--orange)}
    .btn-main.winter{background:var(--winter)}
    .btn-main.grey{background:var(--grey)}
    .btn-ghost{
      background:#fff;
      border:1px solid #cfcfcf;
      color:#555;
      box-shadow:none;
    }
    .btn-main:active{transform:translateY(1px)}
    .error{color:#c62828;font-size:.86rem;margin-top:8px}
    .results{margin-top:12px;padding-top:12px;border-top:1px dashed #cfcfcf}
    .result-row{display:flex;justify-content:space-between;gap:12px;align-items:baseline;margin-bottom:9px}
    .result-label{font-size:.92rem;font-weight:800}
    .result-value{
      font-size:1.02rem;
      font-weight:900;
      text-decoration:underline;
      text-decoration-thickness:2px;
      white-space:nowrap;
    }
    .result-value.orange{color:var(--orange-dark)}
    .result-value.winter{color:var(--winter-dark)}
    .result-label.sub{font-size:.78rem;font-weight:600;color:#666}
    .result-value.sub{font-size:.85rem;font-weight:700;color:#555;text-decoration:none;opacity:.9}
    .note{
      margin-top:10px;
      border-radius:12px;
      padding:10px 12px;
      font-size:.92rem;
      line-height:1.35;
      display:none;
    }
    .note.ok{background:#e8f5e9;color:#1b5e20;border:1px solid #c8e6c9}
    .note.warn{background:#fff8e1;color:#6d4c00;border:1px solid #ffe082}
    .decimal{font-size:.78rem;color:#666;text-decoration:none;margin-top:2px}
    .footer{
      margin-top:10px;
      text-align:center;
      color:#888;
      font-size:.78rem;
      padding:0 0 2px;
    }
    .pill{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:.78rem;
      font-weight:800;
      border:1px solid rgba(0,0,0,.12);
      background:#fafafa;
      color:#555;
      margin-left:6px;
    }
    .snow{margin-right:6px}
  </style>
</head>
<body>

<div class="grid">

  
  <!-- Rechner 1 -->
  <section class="card" data-calc="r1">
    <div class="header orange">Rechner 1 â€“ Dienstende-Wunsch</div>
    <div class="content">
      <h2>Wunsch-Feierabend â†’ Tageszettel & Zeitkonto</h2>
      <div class="hint">
        Du gibst <b>Dienstbeginn</b> und <b>Dienstende (Wunsch)</b> ein. Der Rechner zeigt dir
        <b>Zeit auf dem Tageszettel</b> (ohne Pause, Duschzeit zÃ¤hlt mit) und die nÃ¶tige <b>Entnahme ZEITKONTO</b>.
      </div>

      <div class="row">
        <label for="r1_start">Dienstbeginn</label>
        <input id="r1_start" type="time">
        <small>z. B. 05:30</small>
      </div>

      <div class="row">
        <label for="r1_wunsch">Dienstende (Wunsch)</label>
        <input id="r1_wunsch" type="time">
        <small>z. B. 13:30</small>
      </div>

      <div class="row">
        <label for="r1_fix">Dienstzeit (fix)</label>
        <div class="inputs-inline">
          <input id="r1_fix" type="time" value="07:48">
          <small>Standard: 7:48 h</small>
        </div>
      </div>

      <div class="row">
        <label for="r1_pause">Pause</label>
        <div class="inputs-inline">
          <input id="r1_pause" type="time" value="00:30">
          <small>Standard: 0:30 h (falls keine Pause: 00:00)</small>
        </div>
      </div>

      <div class="btn-row">
        <button class="btn-main" type="button" onclick="r1_calc()">ðŸ‘‰ Berechnen</button>
        <button class="btn-ghost" type="button" onclick="r1_reset()">â™» ZurÃ¼cksetzen</button>
      </div>

      <div id="r1_err" class="error"></div>

      <div class="results" id="r1_results" style="display:none;">
        <div class="result-row">
          <div class="result-label">Dienstende regulÃ¤r (mit Duschen)</div>
          <div class="result-value orange" id="r1_regEnd"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Beginn Duschzeit (Wunsch)</div>
          <div class="result-value" id="r1_showerStart"></div>
        </div>

        <div class="result-row">
          <div class="result-label">Zeit auf dem Tageszettel</div>
          <div>
            <div class="result-value" id="r1_tages"></div>
            <div class="decimal" id="r1_tages_dec"></div>
          </div>
        </div>

        <div class="result-row">
          <div class="result-label">Entnahme ZEITKONTO</div>
          <div>
            <div class="result-value" id="r1_take"></div>
            <div class="decimal" id="r1_take_dec"></div>
          </div>
        </div>
      </div>

      <div class="footer">Entwickelt von Max VR13</div>
    </div>
  </section>


  <section class="card" data-calc="r2">
    <div class="header orange">Rechner 2 â€“ Zeitkonto-Entnahme</div>
    <div class="content">
      <h2>FrÃ¼heres Dienstende vs. regulÃ¤r</h2>
      <div class="hint">
        FÃ¼r FÃ¤lle, in denen jemand frÃ¼her geht: Ausgabe <b>Tageszettel</b>, <b>regulÃ¤res Ende</b> und <b>Zeitkonto-Entnahme</b>.
      </div>

      <div class="row">
        <label for="r2_start">Dienstbeginn</label>
        <input id="r2_start" type="time">
        <small>z. B. 05:30</small>
      </div>

      <div class="row">
        <label for="r2_fix">Dienstzeit (fix)</label>
        <input id="r2_fix" type="time" value="07:48">
        <small>Standard: 07:48</small>
      </div>

      <div class="row">
        <label for="r2_takeIn">Entnahme aus dem Zeitkonto</label>
        <input id="r2_takeIn" type="time" value="00:00">
        <small>z. B. 02:00 (Kollege geht 2:00 frÃ¼her)</small>
      </div>

      <!-- Pause als LETZTE Eingabe -->
      <div class="row">
        <label for="r2_pause">Pause (optional)</label>
        <input id="r2_pause" type="time" value="00:30">
        <small>Standard 00:30 Â· wenn keine Pause: 00:00</small>
      </div>

      <div class="btn-row">
        <button class="btn-main orange" type="button" onclick="r2_calc()">ðŸ‘‰ Berechnen</button>
        <button class="btn-ghost" type="button" onclick="r2_reset()">â™» ZurÃ¼cksetzen</button>
      </div>

      <div id="r2_err" class="error"></div>

      <div id="r2_res" class="results" style="display:none;">
        <div class="result-row">
          <div class="result-label">Tageszettel</div>
          <div class="result-value orange" id="r2_tz"></div>
        </div>
        <div class="result-row">
          <div class="result-label sub">Tageszettel (dezimal)</div>
          <div class="result-value sub" id="r2_tz_dec"></div>
        </div>
        <div class="result-row">
          <div class="result-label">RegulÃ¤res Ende</div>
          <div class="result-value" id="r2_regEnd"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Dienstende (mit Duschen)</div>
          <div class="result-value orange" id="r2_end"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Beginn Duschzeit</div>
          <div class="result-value" id="r2_shower"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Zeitkonto-Entnahme</div>
          <div class="result-value" id="r2_take"></div>
        </div>
      </div>
        <div class="result-row">
          <div class="result-label">&nbsp;</div>
          <div class="result-value sub" id="r2_take_dec"></div>
        </div>

      <div class="footer">Entwickelt von Max VR13</div>
    </div>
  </section>

  <!-- Rechner 3 -->
  <section class="card" data-calc="r3">
    <div class="header orange">Rechner 3 â€“ Spontanfeierabend</div>
    <div class="content">
      <h2>Feierabend ab â€žjetztâ€œ</h2>
      <div class="hint">
        Kollege fragt spontan Feierabend an. Du gibst <b>Anfragezeit</b> und <b>Dienstbeginn</b> ein.<br>
        Ausgabe: <b>Tageszettel</b>, <b>spontanes Ende mit Duschen</b> und <b>Zeitkonto-Entnahme</b>.
      </div>

      <div class="row">
        <label for="r3_now">Anfragezeit (jetzt)</label>
        <input id="r3_now" type="time">
        <small>z. B. 12:00</small>
      </div>

      <div class="row">
        <label for="r3_start">Dienstbeginn</label>
        <input id="r3_start" type="time">
        <small>z. B. 05:30</small>
      </div>

      <!-- Dienstzeit (fix) + Pause als LETZTE Eingaben -->
      <div class="row">
        <label for="r3_fixWork">Dienstzeit (fix)</label>
        <input id="r3_fixWork" type="time" value="07:48">
        <small>Standard 07:48</small>
      </div>

      <div class="row">
        <label for="r3_pause">Pause</label>
        <input id="r3_pause" type="time" value="00:30">
        <small>Standard 00:30 Â· wenn keine Pause: 00:00</small>
      </div>

      <div class="btn-row">
        <button class="btn-main orange" type="button" onclick="r3_calc()">ðŸ‘‰ Berechnen</button>
        <button class="btn-ghost" type="button" onclick="r3_reset()">â™» ZurÃ¼cksetzen</button>
      </div>

      <div id="r3_err" class="error"></div>

      <div id="r3_res" class="results" style="display:none;">
        <div class="result-row">
          <div class="result-label">Tageszettel</div>
          <div class="result-value orange" id="r3_tz"></div>
        </div>
        <div class="result-row">
          <div class="result-label sub">Tageszettel (dezimal)</div>
          <div class="result-value sub" id="r3_tz_dec"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Spontanes Ende (mit Duschen)</div>
          <div class="result-value" id="r3_end"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Zeitkonto-Entnahme</div>
          <div class="result-value" id="r3_take"></div>
        </div>
      </div>
        <div class="result-row">
          <div class="result-label">&nbsp;</div>
          <div class="result-value sub" id="r3_take_dec"></div>
        </div>

      <div class="footer">Entwickelt von Max VR13</div>
    </div>
  </section>

  <!-- Rechner 4 (Winter) -->
  <section class="card" data-calc="r4">
    <div class="header winter"><span class="snow">&#10052;</span>Rechner 4 â€“ Winterdienst / Rundspruch</div>
    <div class="content">
      <h2>SchichtverlÃ¤ngerung oder Ziel-Arbeitszeit</h2>
      <div class="hint">
        Rundspruch z. B.: â€ž+2:00 SchichtverlÃ¤ngerungâ€œ <i>oder</i> â€žauf 10:00 Arbeitszeitâ€œ.<br>
        Die VerlÃ¤ngerung enthÃ¤lt ggf. bereits <b>15 Min Pause</b>, sobald <b>reine Arbeitszeit &gt; 9:00</b> ist.
        <span class="pill">ArbZG-Hinweis</span>
      </div>

      <div class="row">
        <label for="r4_start">Dienstbeginn</label>
        <input id="r4_start" type="time">
        <small>z. B. 06:00</small>
      </div>

      <div class="row">
        <label for="r4_mode">Bitte Rundspruch wÃ¤hlen</label>
        <select id="r4_mode">
          <option value="none">Kein Rundspruch (Standard 7:48)</option>
          <option value="ext">SchichtverlÃ¤ngerung (z. B. 02:00)</option>
          <option value="target">ArbeitszeitverlÃ¤ngerung auf (z. B. 10:00)</option>
	          <option value="target12inc">ArbeitszeitverlÃ¤ngerung auf 12:00 (inkl. 0:45 Pause)</option>
        </select>
        <small>WÃ¤hle die Art der Anordnung</small>
      </div>

      <div class="row" id="r4_ext_row">
        <label for="r4_ext">SchichtverlÃ¤ngerung (gesamt)</label>
        <input id="r4_ext" type="time" value="00:00">
        <small>z. B. 02:00 (inkl. evtl. 15 Min Pause in der VerlÃ¤ngerung)</small>
      </div>

      <div class="row" id="r4_target_row" style="display:none;">
        <label for="r4_target">ArbeitszeitverlÃ¤ngerung auf (reine Arbeitszeit)</label>
        <input id="r4_target" type="time" value="10:00">
        <small>z. B. 10:00 reine Arbeitszeit (Pause kommt on top)</small>
      </div>

      <div class="row" id="r4_target12_row" style="display:none;">
        <label>ArbeitszeitverlÃ¤ngerung auf 12:00</label>
        <small>Hinweis: Die 12:00 sind <b>Anwesenheitszeit</b> inkl. <b>0:45 Pause</b> (Duschzeit zÃ¤hlt als Arbeitszeit).</small>
      </div>

      <div class="btn-row">
        <button class="btn-main winter" type="button" onclick="r4_calc()">ðŸ‘‰ Berechnen</button>
        <button class="btn-ghost" type="button" onclick="r4_reset()">â™» ZurÃ¼cksetzen</button>
      </div>

      <div id="r4_err" class="error"></div>

      <div id="r4_res" class="results" style="display:none;">
        <div class="result-row">
          <div class="result-label">Dienstende</div>
          <div class="result-value winter" id="r4_end"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Beginn Duschzeit</div>
          <div class="result-value" id="r4_shower"></div>
        </div>

        <div class="result-row">
          <div class="result-label">Tageszettel</div>
          <div class="result-value" id="r4_tz"></div>
        </div>
        <div class="result-row">
          <div class="result-label sub">Tageszettel (dezimal)</div>
          <div class="result-value sub" id="r4_tz_dec"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Pause (ArbZG-Minimum)</div>
          <div class="result-value" id="r4_pause"></div>
        </div>
        <div id="r4_note" class="note"></div>
      </div>

      <div class="footer">Entwickelt von Max VR13</div>
    </div>
  </section>

  <!-- Rechner 5 (Winter) -->
  <section class="card" data-calc="r5">
    <div class="header winter"><span class="snow">&#10052;</span>Rechner 5 â€“ Tageszettel aus Papiere-Abgabe</div>
    <div class="content">
      <h2>Beginn Duschzeit â†’ Tageszettel</h2>
      <div class="hint">
        Du gibst <b>Dienstbeginn</b> und <b>Beginn Duschzeit</b> (Papiere abgeben) ein.<br>
        Pause wird automatisch auf die Mindestpause gesetzt (30 / 45).
        <span class="pill">ArbZG-Hinweis</span>
      </div>

      <div class="row">
        <label for="r5_start">Dienstbeginn</label>
        <input id="r5_start" type="time">
        <small>z. B. 13:30</small>
      </div>

      <div class="row">
        <label for="r5_paper">Beginn Duschzeit (Papiere abgeben)</label>
        <input id="r5_paper" type="time">
        <small>z. B. 22:45</small>
      </div>

      <div class="btn-row">
        <button class="btn-main winter" type="button" onclick="r5_calc()">ðŸ‘‰ Berechnen</button>
        <button class="btn-ghost" type="button" onclick="r5_reset()">â™» ZurÃ¼cksetzen</button>
      </div>

      <div id="r5_err" class="error"></div>

      <div id="r5_res" class="results" style="display:none;">
        <div class="result-row">
          <div class="result-label">Dienstende (mit Duschen)</div>
          <div class="result-value winter" id="r5_end"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Beginn Duschzeit</div>
          <div class="result-value" id="r5_shower"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Pause (automatisch)</div>
          <div class="result-value" id="r5_pause"></div>
        </div>
        <div class="result-row">
          <div class="result-label">Tageszettel</div>
          <div class="result-value" id="r5_tz"></div>
        </div>
        <div class="result-row">
          <div class="result-label sub">Tageszettel (dezimal)</div>
          <div class="result-value sub" id="r5_tz_dec"></div>
        </div>
        <div id="r5_note" class="note"></div>
      </div>

      <div class="footer">Entwickelt von Max VR13</div>
    </div>
  </section>

  
<script>
  // === Helpers ===
  function parseTimeToMinutes(str){
    if(!str) return NaN;
    const p=str.split(":");
    if(p.length<2) return NaN;
    const h=parseInt(p[0],10), m=parseInt(p[1],10);
    if(Number.isNaN(h)||Number.isNaN(m)||m<0||m>59) return NaN;
    return h*60+m;
  }
  function formatClock(mins){
    mins=((mins%(24*60))+(24*60))%(24*60);
    const h=Math.floor(mins/60), m=mins%60;
    return String(h).padStart(2,"0")+":"+String(m).padStart(2,"0")+" Uhr";
  }
  function formatDuration(mins){
    const sign=mins<0?"-":"";
    mins=Math.abs(mins);
    const h=Math.floor(mins/60), m=mins%60;
    return sign + h + ":" + String(m).padStart(2,"0") + " h";
  }
  function diffClock(a,b){
    let d=a-b;
    if(d<0) d+=24*60;
    return d;
  }
  function fmtDec(mins){
    if(!isFinite(mins)) return "";
    return (mins/60).toFixed(2);
  }

  // Aliases used by some calculators (keeps code readable)
  function byId(id){ return document.getElementById(id); }
  function timeToMin(str){ return parseTimeToMinutes(str); }
  function clock(mins){ return formatClock(mins); }
  function dur(mins){ return formatDuration(mins); }
  function dec(mins){ return fmtDec(mins); }

  // Backwards-compat helpers (older versions used these names)
  function formatDurationSigned(mins){ return formatDuration(mins); }
  function formatDecimalHours(mins){ return fmtDec(mins); }

  // === Constants ===
  const BASE_WORK_MIN = 7*60 + 48; // 7:48
  const DUSCH_MIN = 25;
  const LIMIT_9H = 9*60;
  const PAUSE_30 = 30;
  const PAUSE_45 = 45;

  function pauseByArbzg(workNoPauseMin){
    return (workNoPauseMin > LIMIT_9H) ? PAUSE_45 : PAUSE_30;
  }

  
// === Rechner 1 === (Dienstende-Wunsch)
function r1_calc(){
  const err = document.getElementById("r1_err");
  err.textContent = "";
  const startMin = parseTimeToMinutes(document.getElementById("r1_start").value);
  const wunschMin = parseTimeToMinutes(document.getElementById("r1_wunsch").value);
  const fixMin = parseTimeToMinutes(document.getElementById("r1_fix").value);
  const pauseMin = parseTimeToMinutes(document.getElementById("r1_pause").value);

  if (isNaN(startMin) || isNaN(wunschMin) || isNaN(fixMin) || isNaN(pauseMin)) {
    err.textContent = "Bitte Dienstbeginn, Dienstende (Wunsch), Dienstzeit (fix) und Pause eingeben.";
    document.getElementById("r1_results").style.display="none";
    return;
  }

  // Zeit auf Tageszettel = (Wunschende - Dienstbeginn) - Pause  (Duschzeit zÃ¤hlt mit, Pause nicht)
  const presenceToWunsch = diffClock(wunschMin, startMin);
  const tagesMin = presenceToWunsch - pauseMin;

  // Entnahme Zeitkonto = Dienstzeit fix - Tageszettel (nicht < 0)
  const takeMin = Math.max(0, fixMin - tagesMin);

  // RegulÃ¤res Ende (mit Duschen) = Dienstbeginn + Dienstzeit fix + Pause
  const regEndMin = startMin + fixMin + pauseMin;

  // Beginn Duschzeit (Wunsch) = Wunschende - 25 Min
  const showerStartMin = wunschMin - DUSCH_MIN;

  document.getElementById("r1_regEnd").textContent = formatClock(regEndMin);
  document.getElementById("r1_showerStart").textContent = formatClock(showerStartMin);
  document.getElementById("r1_tages").textContent = formatDurationSigned(tagesMin);
  document.getElementById("r1_take").textContent = formatDurationSigned(takeMin);

  document.getElementById("r1_tages_dec").textContent = "(" + formatDecimalHours(tagesMin) + ")";
  document.getElementById("r1_take_dec").textContent = "(" + formatDecimalHours(takeMin) + ")";

  document.getElementById("r1_results").style.display="block";
}
function r1_reset(){
  document.getElementById("r1_start").value="";
  document.getElementById("r1_wunsch").value="";
  document.getElementById("r1_fix").value="07:48";
  document.getElementById("r1_pause").value="00:30";
  document.getElementById("r1_results").style.display="none";
  document.getElementById("r1_err").textContent="";
}

// === Rechner 2 === (Entnahme-Wunsch)
function r2_calc(){
  const err = byId("r2_err"); err.textContent="";
  const start = timeToMin(byId("r2_start").value);
  const fix = timeToMin(byId("r2_fix").value);         // Arbeitszeit (inkl. Duschen), ohne Pause
  const take = timeToMin(byId("r2_takeIn").value);     // Entnahme aus Zeitkonto
  const pause = timeToMin(byId("r2_pause").value);     // Pause kommt "on top"

  if([start,fix,take,pause].some(isNaN)){
    err.textContent="Bitte Dienstbeginn, Dienstzeit (fix), Entnahme und Pause im Format hh:mm eingeben.";
    byId("r2_res").style.display="none";
    return;
  }
  if(take > fix){
    err.textContent="Entnahme darf nicht grÃ¶ÃŸer als die Dienstzeit (fix) sein.";
    byId("r2_res").style.display="none";
    return;
  }

  const regEnd = start + fix + pause;      // regulÃ¤res Dienstende (mit Pause)
  const end = regEnd - take;               // tatsÃ¤chliches Dienstende (mit Entnahme)
  const shower = end - DUSCH_MIN;          // Beginn Duschzeit
  const tz = fix - take;                   // Tageszettel = Arbeitszeit ohne Pause (Dusche zÃ¤hlt mit)

  byId("r2_regEnd").textContent = clock(regEnd);
  byId("r2_end").textContent = clock(end);
  byId("r2_shower").textContent = clock(shower);
  byId("r2_take").textContent = dur(take);
  byId("r2_tz").textContent = dur(tz);
  byId("r2_tz_dec").textContent = dec(tz);
  byId("r2_take_dec").textContent = dec(take);

  byId("r2_res").style.display="block";
}
function r2_reset(){
  document.getElementById("r2_start").value="";
  document.getElementById("r2_takeIn").value="";
  document.getElementById("r2_fix").value="07:48";
  document.getElementById("r2_pause").value="00:30";
  document.getElementById("r2_res").style.display="none";
  document.getElementById("r2_err").textContent="";
}
// === Rechner 3 ===
  function r3_calc(){
    const err=document.getElementById("r3_err");
    err.textContent="";
    const now=parseTimeToMinutes(document.getElementById("r3_now").value);
    const start=parseTimeToMinutes(document.getElementById("r3_start").value);
    const fixWork=parseTimeToMinutes(document.getElementById("r3_fixWork").value);
    const pause=parseTimeToMinutes(document.getElementById("r3_pause").value);
    if([now,start,fixWork,pause].some(Number.isNaN)){
      err.textContent="Bitte alle Eingaben korrekt setzen.";
      document.getElementById("r3_res").style.display="none";
      return;
    }
    const spontaneousEnd = now + DUSCH_MIN;
    const presence = diffClock(spontaneousEnd, start);
    const tageszettel = Math.max(0, presence - pause);

    const regEnd = start + fixWork + pause;
    const take = Math.max(0, diffClock(regEnd, spontaneousEnd));

    document.getElementById("r3_tz").textContent = formatDuration(tageszettel);
    document.getElementById("r3_tz_dec").textContent = fmtDec(tageszettel);
    document.getElementById("r3_end").textContent = formatClock(spontaneousEnd);
    document.getElementById("r3_take").textContent = formatDuration(take);
    document.getElementById("r3_take_dec").textContent = fmtDec(take);
    document.getElementById("r3_res").style.display="block";
  }
  function r3_reset(){
    document.getElementById("r3_now").value="";
    document.getElementById("r3_start").value="";
    document.getElementById("r3_fixWork").value="07:48";
    document.getElementById("r3_pause").value="00:30";
    document.getElementById("r3_err").textContent="";
    document.getElementById("r3_res").style.display="none";
  }

  // === Rechner 4 ===
  function r4_updateMode(){
    const mode=document.getElementById("r4_mode").value;
    const extRow=document.getElementById("r4_ext_row");
    const targetRow=document.getElementById("r4_target_row");
    const target12Row=document.getElementById("r4_target12_row");

    // defaults
    extRow.style.display="none";
    targetRow.style.display="none";
    target12Row.style.display="none";

    if(mode==="ext"){
      extRow.style.display="flex";
    }else if(mode==="target"){
      targetRow.style.display="flex";
    }else if(mode==="target12inc"){
      target12Row.style.display="flex";
    }
  }
  document.getElementById("r4_mode").addEventListener("change", r4_updateMode);
  r4_updateMode();

  function r4_calc(){
    const err=document.getElementById("r4_err");
    const res=document.getElementById("r4_res");
    const note=document.getElementById("r4_note");
    err.textContent=""; note.style.display="none"; note.className="note"; note.textContent="";

    const start=parseTimeToMinutes(document.getElementById("r4_start").value);
    if(Number.isNaN(start)){
      err.textContent="Bitte Dienstbeginn eingeben.";
      res.style.display="none";
      return;
    }

    const mode=document.getElementById("r4_mode").value;
    let extWarn=false;
    const extWarnText="âš ï¸ SchichtverlÃ¤ngerung eingetragen, aber es ist â€žKein Rundspruchâ€œ gewÃ¤hlt. Bitte zuerst einen Rundspruch auswÃ¤hlen. Solange â€žKein Rundspruchâ€œ gewÃ¤hlt ist, wird die SchichtverlÃ¤ngerung nicht berÃ¼cksichtigt.";
    const extVal=document.getElementById("r4_ext").value;
    let extTotal=parseTimeToMinutes(extVal);
    if(Number.isNaN(extTotal)) extTotal=0;
    if (extTotal>0 && mode==="none") {
      // SchichtverlÃ¤ngerung nur im Bitte Rundspruch wÃ¤hlen erlaubt
      note.style.display="block";
      note.className="note warn";
      note.textContent = extWarnText;
      res.style.display="none";
      return;
    }
    let tageszettelMin = BASE_WORK_MIN;
    let pauseMin = pauseByArbzg(tageszettelMin);
    let endMin = start + tageszettelMin + pauseMin;

    if(mode==="ext"){
      const extTotal=parseTimeToMinutes(document.getElementById("r4_ext").value);
      const extTotalMin = Number.isNaN(extTotal) ? 0 : extTotal;

      // SchichtverlÃ¤ngerung ist "gesamt" laut Rundspruch.
      // Wenn dadurch reine Arbeitszeit > 9:00 wird: innerhalb der VerlÃ¤ngerung sind 15 Min Pause enthalten.
      let workCandidate = BASE_WORK_MIN + extTotalMin;
      const needs15InExt = (extTotalMin > 0 && workCandidate > LIMIT_9H);

      const extWork = needs15InExt ? Math.max(0, extTotalMin - 15) : extTotalMin;
      tageszettelMin = BASE_WORK_MIN + extWork;

      pauseMin = pauseByArbzg(tageszettelMin);
      endMin = start + tageszettelMin + pauseMin;

      note.style.display="block";
      if(pauseMin===PAUSE_45){
        note.className="note warn";
        note.textContent="âš ï¸ Reine Arbeitszeit Ã¼ber 9:00 h â†’ mindestens 45 Minuten Pause erforderlich.";
      }else{
        note.className="note ok";
        note.textContent="âœ… Bis 9:00 h reine Arbeitszeit â†’ 30 Minuten Pause ausreichend.";
      }
    }
    else if(mode==="target"){
      const target=parseTimeToMinutes(document.getElementById("r4_target").value);
      if(Number.isNaN(target)){
        err.textContent="Bitte Ziel-Arbeitszeit eingeben.";
        res.style.display="none";
        return;
      }
      tageszettelMin = target;
      pauseMin = pauseByArbzg(tageszettelMin);
      endMin = start + tageszettelMin + pauseMin;

      note.style.display="block";
      if(pauseMin===PAUSE_45){
        note.className="note warn";
        note.textContent="âš ï¸ Reine Arbeitszeit Ã¼ber 9:00 h â†’ mindestens 45 Minuten Pause erforderlich.";
      }else{
        note.className="note ok";
        note.textContent="âœ… Bis 9:00 h reine Arbeitszeit â†’ 30 Minuten Pause ausreichend.";
      }
    }
    else if(mode==="target12inc"){
      // Rundspruch: "ArbeitszeitverlÃ¤ngerung auf 12h" â€“ die 12:00 beinhalten bereits die 45 Minuten Pause.
      // -> Anwesenheitszeit (Start->Ende) = 12:00
      // -> Pause = 0:45 (fest)
      // -> Tageszettel (reine Arbeitszeit) = 12:00 - 0:45 = 11:15
      const totalMin = 12 * 60;
      pauseMin = PAUSE_45;
      tageszettelMin = totalMin - pauseMin;
      endMin = start + totalMin;

      note.style.display="block";
      note.className="note warn";
      note.textContent="âš ï¸ Rundspruch 12:00 h: die 45 Minuten Pause sind bereits enthalten. Tageszettel = 11:15 h.";
    }
    else {
      // none
      tageszettelMin = BASE_WORK_MIN;
      pauseMin = pauseByArbzg(tageszettelMin);
      endMin = start + tageszettelMin + pauseMin;

      note.style.display="block";
      note.className="note ok";
      note.textContent="âœ… Standard: 7:48 h Arbeitszeit (Pause nach ArbZG automatisch 0:30).";
    }

    document.getElementById("r4_end").textContent = formatClock(endMin);
    const showerStartMin = endMin - DUSCH_MIN;
    document.getElementById("r4_shower").textContent = formatClock(showerStartMin);
    document.getElementById("r4_tz").textContent = formatDuration(tageszettelMin);
    document.getElementById("r4_tz_dec").textContent = fmtDec(tageszettelMin);
    document.getElementById("r4_pause").textContent = formatDuration(pauseMin);
    res.style.display="block";
  }
  function r4_reset(){
    document.getElementById("r4_start").value="";
    document.getElementById("r4_mode").value="none";
    document.getElementById("r4_ext").value="00:00";
    document.getElementById("r4_target").value="10:00";
    document.getElementById("r4_err").textContent="";
    document.getElementById("r4_res").style.display="none";
    r4_updateMode();
    const noteEl = document.getElementById("r4_note");
    noteEl.style.display="none";
    noteEl.textContent="";
    noteEl.className="note";
  }

  // === Rechner 5 ===
  function r5_calc(){
    const err=document.getElementById("r5_err");
    const res=document.getElementById("r5_res");
    const note=document.getElementById("r5_note");
    err.textContent=""; note.style.display="none"; note.className="note"; note.textContent="";

    const start=parseTimeToMinutes(document.getElementById("r5_start").value);
    const paper=parseTimeToMinutes(document.getElementById("r5_paper").value);
    if(Number.isNaN(start)||Number.isNaN(paper)){
      err.textContent="Bitte Dienstbeginn und Beginn Duschzeit eingeben.";
      res.style.display="none";
      return;
    }
    const end = paper + DUSCH_MIN;
    const presence = diffClock(end, start);

    // Pause automatisch
    const pause = ((presence - PAUSE_30) > LIMIT_9H) ? PAUSE_45 : PAUSE_30;
    const tageszettel = Math.max(0, presence - pause);

    document.getElementById("r5_end").textContent = formatClock(end);
    document.getElementById("r5_shower").textContent = formatClock(paper);
    document.getElementById("r5_pause").textContent = formatDuration(pause);
    document.getElementById("r5_tz").textContent = formatDuration(tageszettel);
    document.getElementById("r5_tz_dec").textContent = fmtDec(tageszettel);

    note.style.display="block";
    if(pause===PAUSE_45){
      note.className="note warn";
      note.textContent="âš ï¸ Reine Arbeitszeit Ã¼ber 9:00 h â†’ 45 Minuten Pause erforderlich (automatisch berÃ¼cksichtigt).";
    }else{
      note.className="note ok";
      note.textContent="âœ… Bis 9:00 h reine Arbeitszeit â†’ 30 Minuten Pause ausreichend (automatisch berÃ¼cksichtigt).";
    }

    res.style.display="block";
  }
  function r5_reset(){
    document.getElementById("r5_start").value="";
    document.getElementById("r5_paper").value="";
    document.getElementById("r5_err").textContent="";
    document.getElementById("r5_res").style.display="none";
  }

  

  // === Enter-Taste lÃ¶st Berechnen aus (PC) ===
  const calcMap = {
    r1: r1_calc,
    r2: r2_calc,
    r3: r3_calc,
    r4: r4_calc,
    r5: r5_calc,
    // r6 hat keine Berechnen-Taste
  };
  document.querySelectorAll('section.card[data-calc]').forEach(card=>{
    const key = card.getAttribute('data-calc');
    const fn = calcMap[key];
    if(!fn) return;
    card.querySelectorAll('input, select').forEach(el=>{
      el.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter'){
          e.preventDefault();
          fn();
        }
      });
    });
  });
</script>
</body>
</html>
